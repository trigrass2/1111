/*------------------------------------------------------------------------
 Module:       	ft.c
 Author:        solar
 Project:       
 State:			
 Creation Date:	2008-09-23
 Description:  
------------------------------------------------------------------------*/
/*------------------------------------------------------------------------
 $Rev: 11 $
------------------------------------------------------------------------*/

#include <syscfg.h>

#ifdef INCLUDE_YC

#include "ad.h"
#include "ft.h"
#include "ai.h"
#include "yc.h"

//===================================================================
//	供傅氏滤波使用的数据
//===================================================================
#if 0
/*20点系数，单点差分*/
long laFAFre[9][FT_SAM_POINT_N]=
{
	{0,	3236,	6156,	8473,	9961,	10473,	 9961,	 8473,	 6156,	 3236,	
	 0, -3236,  -6156,  -8473,  -9961,  -10473,	-9961,	-8473,	-6156,	-3236, },

	{0,	3116,	5043,	5043,	3116,	0,	 -3116,	 -5043,	 -5043,	 -3116,	
	 0, 3116,   5043,   5043,   3116,   0,   -3116,  -5043,  -5043,  -3116, },

	{0, 2920,   3432,   1115,   -2121, 	-3609, -2121,  1115,   3432,  2920, 
	 0, -2920,  -3432,  -1115,  2121,   3609,   2121,  -1115,  -3432, -2920, },

	{0, 2651,   1638,   -1638,  -2651,    0,    2651,   1638,   -1638,  -2651, 	
	 0, 2651,   1638,   -1638,  -2651,    0,    2651,   1638,   -1638,  -2651,    },

	{0, 2317,   0,      -2317,  0,       2317,   0,     -2317,   0,    2317,    	
	 0, -2317,  0,      2317,   0,       -2317,  0,     2317,    0,    -2317, },

	{0, 1926,   -1190,  -1190,   1926,   0,     -1926,   1190,  1190,   -1926, 	
	 0, 1926,   -1190,  -1190,   1926,   0,     -1926,   1190,  1190,   -1926, },

	{0, 1488,   -1749,   568,    1081,    -1839,  1081,    568,   -1749,  1488,	
	 0, -1488,   1749,  -568,   -1081,    1839,  -1081,  -568,    1749,  -1488, },

	{0, 1013,   -1638,  1638,    -1013,    0,    1013,    -1638,  1638,  -1013,   
	 0, 1013,   -1638,  1638,    -1013,    0,    1013,    -1638,  1638,  -1013, },
	 
	{0, 513,    -975,   1342,    -1578,    1659,    -1578,    1342,    -975,    513,  
	 0, -513,    975,   -1342,    1578,    -1659,    1578,    -1342,    975,   -513, },
};

long laFAFim[9][FT_SAM_POINT_N]=
{
	{10473,	 9961,	8473,	6156,	3236,	0,	-3236,	-6156,	-8473,	-9961, 
	 -10473,  -9961, -8473,	-6156,	-3236,	-0,   3236,   6156,   8473,   9961, },

	{5302, 4289, 1638,  -1638,  -4289,  -5302,  -4289,  -1638,  1638,    4289,    
	 5302, 4289, 1638,  -1638,  -4289,  -5302,  -4289,  -1638,  1638,    4289,   },

	{3609,  2121,  -1115,  -3432,   -2920,   0,  2920,  3432,  1115,    -2121,   
	 -3609, -2121,  1115,   3432,   2920,   0,  -2920,  -3432,  -1115,   2121,  },

	{2787,  861,  -2255,   -2255,  861,  2787,  861,  -2255,   -2255,   861,    
	 2787,  861,   -2255,  -2255,  861,   2787,  861,  -2255,   -2255,   861,  },

	{2317,   0,    -2317,   0,    2317,   0,    -2317,    0,    2317,    0,    
     -2317,  0,    2317,    0,    -2317,  0,    2317,     0,    -2317,   0,  },  

	{2025,  -626,  -1638,  1638,  626,  -2025,   626,  1638,  -1638,  -626,  
	 2025,  -626,  -1638,  1638,  626,  -2025,   626,  1638,  -1638,  -626, },

	{1839,  -1081,  -568,  1749,  -1488,   0,   1488,   -1749,   568,   1081, 
	 -1839,   1081,  568,  -1749,  1488,   0,  -1488,    1749,  -568,  -1081, },
	 
	{1723,  -1394,   532,  532,   -1394,   1723,  -1394,  532,  532,   -1394, 
	 1723,  -1394,   532,  532,   -1394,   1723,  -1394,  532,  532,   -1394,  },

	{1659,   -1578,  1342, -975,   513,    0,    -513,  975,  -1342,    1578,   
	 -1659,   1578, -1342,  975,  -513,    0,    513,  -975,   1342,   -1578,  },    
};
#else
/*20点系数，三点差分*/
long laFAFre[9][FT_SAM_POINT_N]=
{
	{0,  1115,  2121,  2919,  3432,  3608,  3432,  2919,  2121,  1115,  
     0,  -1115,  -2121,  -2919,  -3432,  -3608,  -3432,  -2919,  -2121,  -1115, },

	{0,  1190,  1926,  1926,  1190,  0,  -1190,  -1926,  -1926,  -1190,  
     0,  1190,  1926,  1926,  1190,  0,  -1190,  -1926,  -1926,  -1190,},
     
    {0,  1342,  1577,  512,  -975,  -1658,  -975,  512,  1577,  1342,  
     0,  -1342,  -1577,  -512,  975,  1658,  975,  -512,  -1577,  -1342,},
    
    {0,  1638,  1012,  -1012,  -1638,  0,  1638,  1012,  -1012,  -1638,  
     0,  1638,  1012,  -1012,  -1638,  0,  1638,  1012,  -1012,  -1638,},
     
    {0,  2317,  0,  -2317,  0,  2317,  0,  -2317,  0,  2317,  
     0,  -2317,  0,  2317,  0,  -2317,  0,  2317,  0,  -2317, },
     
    {0,  5042,  -3116,  -3116,  5042,  0,  -5042,  3116,  3116,  -5042,  
     0,  5042,  -3116,  -3116,  5042,  0,  -5042,  3116,  3116,  -5042, },
     
    {0,  -8473,  9960,  -3236,  -6156,  10473,  -6156,  -3236,  9960,  -8473,  
     0,  8473,  -9960,  3236,  6156,  -10473,  6156,  3236,  -9960,  8473,  },
     
    {0,  -1638,  2650,  -2650,  1638,  0,  -1638,  2650,  -2650,  1638,  
     0,  -1638,  2650,  -2650,  1638,  0,  -1638,  2650,  -2650,  1638, },
     
    {0,  -568,  1080,  -1487,  1748,  -1838,  1748,  -1487,  1080,  -568,  
     0,  568,  -1080,  1487,  -1748,  1838,  -1748,  1487,  -1080,  568, },
};

long laFAFim[9][FT_SAM_POINT_N]=
{
	{3608,  3432,  2919,  2121,  1115,  0,  -1115,  -2121,  -2919,  -3432,  
     -3608,  -3432,  -2919,  -2121,  -1115,  0,  1115,  2121,  2919,  3432,  },
     
    {2025,  1638,  625,  -625,  -1638,  -2025,  -1638,  -625,  625,  1638,  
     2025,  1638,  625,  -625,  -1638,  -2025,  -1638,  -625,  625,  1638,  },
     
    {1658,  975,  -512,  -1577,  -1342,  0,  1342,  1577,  512,  -975,  
     -1658,  -975,  512,  1577,  1342,  0,  -1342,  -1577,  -512,  975,  },
     
    {1722,  532,  -1393,  -1393,  532,  1722,  532,  -1393,  -1393,  532,  
     1722,  532,  -1393,  -1393,  532,  1722,  532,  -1393,  -1393,  532, },
     
    {2317,  0,  -2317,  0,  2317,  0,  -2317,  0,  2317,  0,  
     -2317,  0,  2317,  0,  -2317,  0,  2317,  0,  -2317,  0, },
     
    {5301,  -1638,  -4289,  4289,  1638,  -5301,  1638,  4289,  -4289,  -1638,  
     5301,  -1638,  -4289,  4289,  1638,  -5301,  1638,  4289,  -4289,  -1638, },
     
    {-10473,  6156,  3236,  -9960,  8473,  0,  -8473,  9960,  -3236,  -6156,  
     10473,  -6156,  -3236,  9960,  -8473,  0,  8473,  -9960,  3236,  6156, },
     
    {-2787,  2255,  -861,  -861,  2255,  -2787,  2255,  -861,  -861,  2255,  
     -2787,  2255,  -861,  -861,  2255,  -2787,  2255,  -861,  -861,  2255, },
     
    {-1838,  1748,  -1487,  1080,  -568,  0,  568,  -1080,  1487,  -1748,  
      1838,  -1748,  1487,  -1080,  568,  0,  -568,  1080,  -1487,  1748, },
};
#endif
#if (DEV_SP != DEV_SP_TTU)
/*40点，三点差分*/
long laFAFre2[13][MEA_SAM_POINT_N]=
{
    {0,     548,   1084,  1593,  2062,  2481,  2838,  3126,  3337,  3465,  
     3509,  3465,  3337,  3126,  2838,  2481,  2062,  1593,  1084,  548,  
     0,    -548,  -1084,  -1593,  -2062,  -2481,  -2838,  -3126,  -3337,  -3465,  
    -3509,  -3465,  -3337,  -3126,  -2838,  -2481,  -2062,  -1593,  -1084,  -548, },
    
    {0,     557,   1060,   1459,   1716,   1804,   1716,   1459,   1060,   557,  
     0,    -557,  -1060,  -1459,  -1716,  -1804,  -1716,  -1459,  -1060,  -557,  
     0,     557,   1060,   1459,   1716,   1804,   1716,   1459,   1060,   557,  
     0,    -557,  -1060,  -1459,  -1716,  -1804,  -1716,  -1459,  -1060,  -557, },
     
    {0,     572,    1020,   1245,   1199,    891,   389,    -197,   -741,  -1123,  
    -1261,  -1123,  -741,   -197,   389,     891,   1199,   1245,   1020,   572,  
     0,     -572,   -1020,  -1245,  -1199,  -891,   -389,   197,    741,   1123,  
     1261,  1123,    741,    197,   -389,   -891,   -1199,  -1245,  -1020,  -572, },
     
    {0,     595,     963,    963,    595,     0,     -595,  -963,   -963,   -595,  
     0,     595,     963,    963,    595,     0,     -595,  -963,   -963,   -595,  
     0,     595,     963,    963,    595,     0,     -595,  -963,   -963,   -595,  
     0,     595,     963,    963,    595,     0,     -595,  -963,    -963,  -595, },
     
    {0,    626,     886,    626,     0,     -626,   -886,   -626,    0,    626,  
     886,  626,     0,     -626,    -886,   -626,    0,      626,    886,  626,  
     0,   -626,    -886,   -626,     0,      626,    886,    626,    0,   -626,  
    -886, -626,     0,      626,     886,    626,    0,     -626,   -886,  -626, },
     
    {0,    671,     788,    256,    -487,    -829,  -487,    256,    788,   671,  
     0,   -671,    -788,    -256,    487,     829,   487,   -256,   -788,  -671,  
     0,    671,     788,     256,   -487,    -829,  -487,    256,    788,   671,  
     0,   -671,    -788,    -256,    487,     829,   487,   -256,   -788,  -671, },
      
    {0,    732,     664,    -128,   -781,    -581,   253,    811,    483,  -373,  
    -821,  -373,    483,     811,    253,    -581,  -781,    -128,   664,  732,  
     0,    -732,   -664,     128,    781,     581,  -253,    -811,  -483,  373,  
     821,  373,    -483,    -811,   -253,     581,  781,      128,  -664,  -732, },
     
    {0,    819,     506,    -506,   -819,     0,    819,      506,  -506,  -819,  
     0,    819,     506,    -506,   -819,     0,    819,      506,  -506,  -819,  
     0,    819,     506,    -506,   -819,     0,    819,      506,  -506,  -819,  
     0,    819,     506,    -506,   -819,     0,    819,      506,  -506,  -819, },
     
    {0,    948,     296,    -856,   -564,     679,  777,     -436,  -913,  150,  
     960,  150,    -913,    -436,    777,     679,  -564,    -856,  296,   948,  
     0,   -948,    -296,     856,    564,    -679,  -777,     436,  913,  -150,  
    -960, -150,     913,     436,   -777,    -679,  564,      856,  -296,  -948, },
    
    {0,    1158,    0,      -1158,   0,       1158,  0,      -1158,  0,    1158,  
     0,    -1158,   0,       1158,   0,      -1158,  0,       1158,  0,    -1158,  
     0,     1158,   0,      -1158,   0,       1158,  0,      -1158,  0,     1158,  
     0,    -1158,   0,       1158,   0,      -1158,  0,       1158,  0,    -1158, },
     
    {0,     1548,  -484,    -1396,  921,      1108,  -1268,  -711,   1491,   245,  
    -1567,  245,   1491,    -711,  -1268,     1108,   921,   -1396,  -484,   1548,  
     0,    -1548,  484,     1396,  -921,     -1108,   1268,  711,    -1491,  -245,  
     1567, -245,  -1491,    711,   1268,     -1108,   -921,  1396,   484,    -1548, },
     
    {0,     2521,  -1558,   -1558,  2521,  0,  -2521,  1558,  1558,  -2521,  
     0,     2521,  -1558,   -1558,  2521,  0,  -2521,  1558,  1558,  -2521,  
     0,     2521,  -1558,   -1558,  2521,  0,  -2521,  1558,  1558,  -2521,  
     0,     2521,  -1558,   -1558,  2521,  0,  -2521,  1558,  1558,  -2521, },
     
    {0,      9303,   -8447,   -1633,  9930,  -7382,  -3226,  10312,  -6137,  -4740,  
     10441,  -4740,  -6137,  10312,  -3226,  -7382,  9930,  -1633,  -8447,  9303,  
     0,      -9303,   8447,  1633,   -9930,   7382,  3226,  -10312,  6137,  4740,  
    -10441,  4740,    6137,  -10312,  3226,  7382,  -9930,   1633,   8447,  -9303, },
};

long laFAFim2[13][MEA_SAM_POINT_N]=
{
    {3509,   3465,  3337,   3126,   2838,   2481,   2062,   1593,   1084,   548,  
     0,     -548,  -1084,  -1593,  -2062,  -2481,  -2838,  -3126,  -3337,  -3465,  
    -3509,  -3465, -3337,  -3126,  -2838,  -2481,  -2062,  -1593,  -1084,  -548,  
     0,      548,   1084,   1593,   2062,   2481,   2838,   3126,   3337,   3465, },
     
    {1804,   1716,  1459,   1060,   557,    0,     -557,    -1060,  -1459,  -1716,  
    -1804,  -1716,  -1459,  -1060,  -557,   0,      557,     1060,   1459,   1716,  
     1804,   1716,  1459,   1060,    557,   0,     -557,    -1060,  -1459,  -1716,  
    -1804,  -1716,  -1459,  -1060,  -557,   0,      557,     1060,   1459,   1716, },
    
    {1261,   1123,  741,     197,   -389,  -891,   -1199,   -1245,  -1020,  -572,  
     0,      572,   1020,    1245,  1199,   891,    389,    -197,   -741,   -1123,  
    -1261,  -1123,  -741,   -197,   389,    891,    1199,   1245,   1020,    572,  
     0,     -572,   -1020,  -1245,  -1199,  -891,  -389,     197,   741,    1123,  },
     
    {1012,   819,   312,    -312,  -819,  -1012,   -819,    -312,   312,     819,  
     1012,   819,   312,    -312,  -819,  -1012,   -819,    -312,   312,     819,  
     1012,   819,   312,    -312,  -819,  -1012,   -819,    -312,   312,     819,  
     1012,   819,   312,    -312,  -819,  -1012,   -819,    -312,   312,     819, },
     
    {886,    626,   0,     -626,   -886,  -626,     0,       626,   886,     626,  
     0,     -626,  -886,   -626,    0,     626,     886,     626,    0,     -626,  
    -886,   -626,   0,      626,    886,   626,     0,      -626,   -886,   -626,  
     0,      626,   886,    626,    0,    -626,    -886,    -626,    0,      626, },
     
    {829,    487,  -256,   -788,   -671,   0,       671,     788,    256,   -487,  
    -829,   -487,   256,    788,    671,   0,      -671,    -788,   -256,    487,  
     829,    487,  -256,   -788,   -671,   0,       671,     788,    256,   -487,  
    -829,   -487,   256,    788,    671,   0,      -671,    -788,   -256,    487, },
    
    {821,    373,  -483,   -811,  -253,    581,     781,     128,   -664,    -732,  
     0,      732,   664,   -128,  -781,   -581,     253,     811,    483,    -373,  
    -821,   -373,   483,    811,   253,   -581,    -781,    -128,    664,     732,  
     0,     -732,  -664,    128,   781,    581,    -253,    -811,   -483,     373, },
     
    {861,    266,  -696,   -696,   266,    861,     266,    -696,   -696,     266,  
     861,    266,  -696,   -696,   266,    861,     266,    -696,   -696,     266,  
     861,    266,  -696,   -696,   266,    861,     266,    -696,   -696,     266,  
     861,    266,  -696,   -696,   266,    861,     266,    -696,   -696,     266, },
     
    {960,    150,  -913,   -436,   777,    679,    -564,    -856,     296,    948,  
     0,     -948,  -296,    856,   564,   -679,    -777,     436,     913,   -150,  
    -960,   -150,   913,    436,  -777,   -679,     564,     856,    -296,   -948,  
     0,      948,   296,   -856,  -564,    679,     777,    -436,    -913,    150, },
     
    {1158,   0,    -1158,   0,      1158,   0,     -1158,     0,      1158,   0,  
    -1158,   0,     1158,   0,     -1158,   0,      1158,     0,      -1158,  0,  
     1158,   0,    -1158,   0,      1158,   0,     -1158,     0,       1158,  0,  
    -1158,   0,     1158,    0,    -1158,   0,      1158,     0,      -1158,  0, },
    
    {1567,   -245,   -1491,  711,   1268,   -1108,   -921,   1396,     484,   -1548,  
      0,     1548,   -484,  -1396,  921,     1108,   -1268,  -711,     1491,   245,  
     -1567,  245,     1491, -711,  -1268,    1108,    921,   -1396,    -484,   1548,  
      0,    -1548,    484,  1396,  -921,    -1108,    1268,  711,      -1491,  -245, },
      
    {2650,   -819,   -2144,   2144,   819,  -2650,    819,    2144,    -2144,   -819,  
     2650,   -819,   -2144,   2144,   819,  -2650,    819,    2144,    -2144,   -819,  
     2650,   -819,   -2144,   2144,   819,  -2650,    819,    2144,    -2144,   -819,  
     2650,   -819,   -2144,   2144,   819,  -2650,    819,    2144,    -2144,   -819, },
     
    {10441,  -4740,  -6137,   10312,  -3226,  -7382,  9930,  -1633,    -8447,   9303,  
      0,     -9303,   8447,   1633,   -9930,   7382,  3226,  -10312,    6137,   4740,  
    -10441,   4740,   6137,  -10312,   3226,   7382,  -9930,  1633,     8447,  -9303,  
      0,      9303,  -8447,  -1633,    9930,  -7382,  -3226,  10312,   -6137,  -4740, },
};

#else
/*32*/
long laFAFre2[13][MEA_SAM_POINT_N]=
{
   {0,  688,  1350,  1960,  2494,  2933,  3259,  3460,  3528,  3460,  
	3259,  2933,  2494,  1960,  1350,  688,  0,  -687,  -1349,  -1959,  
	-2493,  -2932,  -3258,  -3459,  -3527,  -3459,  -3258,  -2932,  -2493,  -1959,  
	-1349,  -687,  },
	
	{0,  705,  1303,  1703,  1843,  1703,  1303,  705,  0,  -704,  
	-1302,  -1702,  -1842,  -1702,  -1302,  -704,  0,  705,  1303,  1703,  
	1843,  1703,  1303,  705,  0,  -704,  -1302,  -1702,  -1842,  -1702,  
	-1302,  -704,  },
	
	{0,  736,  1224,  1299,  937,  258,  -506,  -1100,  -1324,  -1100,  
	-506,  258,  937,  1299,  1224,  736,  0,  -735,  -1223,  -1298,  
	-936,  -257,  507,  1101,  1325,  1101,  507,  -257,  -936,  -1298,  
	-1223,  -735,  },
	
	{0,  784,  1108,  784,  0,  -783,  -1107,  -783,  0,  784,  
	1108,  784,  0,  -783,  -1107,  -783,  0,  784,  1108,  784,  
	0,  -783,  -1107,  -783,  0,  784,  1108,  784,  0,  -783,  
	-1107,  -783,  },
	
	{0,  856,  951,  201,  -727,  -1008,  -393,  572,  1029,  572,  
	-393,  -1008,  -727,  201,  951,  856,  0,  -855,  -950,  -200,  
	728,  1009,  394,  -571,  -1028,  -571,  394,  1009,  728,  -200,  
	-950,  -855,  },
	
	{0,  965,  738,  -399,  -1043,  -399,  738,  965,  0,  -964,  
	-737,  400,  1044,  400,  -737,  -964,  0,  965,  738,  -399,  
	-1043,  -399,  738,  965,  0,  -964,  -737,  400,  1044,  400,  
	-737,  -964,  },
	
	{0,  1139,  444,  -964,  -820,  645,  1073,  -226,  -1160,  -226,  
	1073,  645,  -820,  -964,  444,  1139,  0,  -1138,  -443,  965,  
	821,  -644,  -1072,  227,  1161,  227,  -1072,  -644,  821,  965,  
	-443,  -1138,  },
	
	{0,  1448,  0,  -1447,  0,  1448,  0,  -1447,  0,  1448,  
	0,  -1447,  0,  1448,  0,  -1447,  0,  1448,  0,  -1447,  
	0,  1448,  0,  -1447,  0,  1448,  0,  -1447,  0,  1448,  
	0,  -1447,  },
	
	{0,  2131,  -830,  -1805,  1536,  1207,  -2006,  -423,  2172,  -423,  
	-2006,  1207,  1536,  -1805,  -830,  2131,  0,  -2130,  831,  1806,  
	-1535,  -1206,  2007,  424,  -2171,  424,  2007,  -1206,  -1535,  1806,  
	831,  -2130,  },
	
	{0,  4849,  -3710,  -2008,  5249,  -2008,  -3710,  4849,  0,  -4848,  
	3711,  2009,  -5248,  2009,  3711,  -4848,  0,  4849,  -3710,  -2008,  
	5249,  -2008,  -3710,  4849,  0,  -4848,  3711,  2009,  -5248,  2009,  
	3712,  -4848,  },
	
	{0,  -8685,  9652,  -2037,  -7386,  10246,  -3997,  -5803,  10447,  -5803,  
	-3997,  10246,  -7386,  -2037,  9652,  -8685,  0,  8686,  -9651,  2038,  
	7387,  -10245,  3998,  5804,  -10446,  5804,  3998,  -10245,  7387,  2038,  
	-9651,  8686,  },
	
	{0,  -1891,  2676,  -1891,  0,  1892,  -2675,  1892,  0,  -1891,  
	2676,  -1891,  0,  1892,  -2675,  1892,  0,  -1891,  2676,  -1891,  
	0,  1892,  -2675,  1892,  0,  -1891,  2676,  -1891,  0,  1892,  
	-2675,  1892,  },
	
	{0,  -896,  1491,  -1582,  1141,  -314,  -617,  1342,  -1613,  1342,  
	-617,  -314,  1141,  -1582,  1491,  -896,  0,  897,  -1490,  1583,  
	-1140,  315,  618,  -1341,  1614,  -1341,  618,  315,  -1140,  1583,  
	-1490,  897,  },

};

long laFAFim2[13][MEA_SAM_POINT_N]=
{
	{3528,  3460,  3259,  2933,  2494,  1960,  1350,  688,  0,  -687,  
	-1349,  -1959,  -2493,  -2932,  -3258,  -3459,  -3527,  -3459,  -3258,  -2932,  
	-2493,  -1959,  -1349,  -687,  0,  688,  1350,  1960,  2494,  2933,  
	3259,  3460,  },
	
	{1843,  1703,  1303,  705,  0,  -704,  -1302,  -1702,  -1842,  -1702,  
	-1302,  -704,  0,  705,  1303,  1703,  1843,  1703,  1303,  705,  
	0,  -704,  -1302,  -1702,  -1842,  -1702,  -1302,  -704,  0,  705,  
	1303,  1703,  },
	
	{1325,  1101,  507,  -257,  -936,  -1298,  -1223,  -735,  0,  736,  
	1224,  1299,  937,  258,  -506,  -1100,  -1324,  -1100,  -506,  258,  
	937,  1299,  1224,  736,  0,  -735,  -1223,  -1298,  -936,  -257,  
	507,  1101,  },
	
	{1108,  784,  0,  -783,  -1107,  -783,  0,  784,  1108,  784,  
	0,  -783,  -1107,  -783,  0,  784,  1108,  784,  0,  -783,  
	-1107,  -783,  0,  784,  1108,  784,  0,  -783,  -1107,  -783,  
	0,  784,  },
	
	{1029,  572,  -393,  -1008,  -727,  201,  951,  856,  0,  -855,  
	-950,  -200,  728,  1009,  394,  -571,  -1028,  -571,  394,  1009,  
	728,  -200,  -950,  -855,  0,  856,  951,  201,  -727,  -1008,  
	-393,  572,  },
	
	{1044,  400,  -737,  -964,  0,  965,  738,  -399,  -1043,  -399,  
	738,  965,  0,  -964,  -737,  400,  1044,  400,  -737,  -964,  
	0,  965,  738,  -399,  -1043,  -399,  738,  965,  0,  -964,  
	-737,  400,  },
	
	{1161,  227,  -1072,  -644,  821,  965,  -443,  -1138,  0,  1139,  
	444,  -964,  -820,  645,  1073,  -226,  -1160,  -226,  1073,  645,  
	-820,  -964,  444,  1139,  0,  -1138,  -443,  965,  821,  -644,  
	-1072,  227,  },
	
	{1448,  0,  -1447,  0,  1448,  0,  -1447,  0,  1448,  0,  
	-1447,  0,  1448,  0,  -1447,  0,  1448,  0,  -1447,  0,  
	1448,  0,  -1447,  0,  1448,  0,  -1447,  0,  1448,  0,  
	-1447,  0,  },
	
	{2172,  -423,  -2006,  1207,  1536,  -1805,  -830,  2131,  0,  -2130,  
	831,  1806,  -1535,  -1206,  2007,  424,  -2171,  424,  2007,  -1206,  
	-1535,  1806,  831,  -2130,  0,  2131,  -830,  -1805,  1536,  1207,  
	-2006,  -423,  },
	
	{5249,  -2008,  -3710,  4849,  0,  -4848,  3711,  2009,  -5248,  2009,  
	3711,  -4848,  0,  4849,  -3710,  -2008,  5249,  -2008,  -3710,  4849,  
	0,  -4848,  3711,  2009,  -5248,  2009,  3712,  -4848,  0,  4849,  
	-3710,  -2008,  },
	
	{-10446,  5804,  3998,  -10245,  7387,  2038,  -9651,  8686,  0,  -8685,  
	9652,  -2037,  -7386,  10246,  -3997,  -5803,  10447,  -5803,  -3997,  10246,  
	-7386,  -2037,  9652,  -8685,  0,  8686,  -9651,  2038,  7387,  -10245,  
	3998,  5804,  },
	
	{-2675,  1892,  0,  -1891,  2676,  -1891,  0,  1892,  -2675,  1892,  
	0,  -1891,  2676,  -1891,  0,  1892,  -2675,  1892,  0,  -1891,  
	2676,  -1891,  0,  1892,  -2675,  1892,  0,  -1891,  2676,  -1891,  
	0,  1892,  },
	
	{-1613,  1342,  -617,  -314,  1141,  -1582,  1491,  -896,  0,  897,  
	-1490,  1583,  -1140,  315,  618,  -1341,  1614,  -1341,  618,  315,  
	-1140,  1583,  -1490,  897,  0,  -896,  1491,  -1582,  1141,  -314,  
	-617,  1342, },
};

#endif


//将0-1均分256, 每点为i*1/256,然后求arcsin,再放大65536倍
DWORD ASin[]=
{
	0x00000000,0x0000394B,0x00007297,0x0000ABE4,0x0000E531,
	0x00011E7F,0x000157CE,0x0001911E,0x0001CA70,0x000203C4,
	0x00023D1A,0x00027672,0x0002AFCD,0x0002E92A,0x0003228A,
	0x00035BED,0x00039554,0x0003CEBE,0x0004082C,0x0004419F,
	0x00047B15,0x0004B490,0x0004EE10,0x00052795,0x0005611E,
	0x00059AAE,0x0005D443,0x00060DDE,0x0006477F,0x00068126,
	0x0006BAD5,0x0006F489,0x00072E46,0x00076809,0x0007A1D4,
	0x0007DBA7,0x00081581,0x00084F65,0x00088950,0x0008C345,
	0x0008FD42,0x00093749,0x00097159,0x0009AB74,0x0009E598,
	0x000A1FC6,0x000A59FF,0x000A9443,0x000ACE92,0x000B08EC,
	0x000B4352,0x000B7DC4,0x000BB842,0x000BF2CC,0x000C2D63,
	0x000C6807,0x000CA2B8,0x000CDD76,0x000D1843,0x000D531D,
	0x000D8E06,0x000DC8FD,0x000E0403,0x000E3F19,0x000E7A3E,
	0x000EB572,0x000EF0B7,0x000F2C0C,0x000F6772,0x000FA2E9,
	0x000FDE71,0x00101A0B,0x001055B6,0x00109174,0x0010CD45,
	0x00110928,0x0011451F,0x00118129,0x0011BD46,0x0011F979,
	0x001235BF,0x0012721B,0x0012AE8C,0x0012EB12,0x001327AE,
	0x00136461,0x0013A12A,0x0013DE0A,0x00141B02,0x00145812,
	0x00149539,0x0014D27A,0x00150FD3,0x00154D45,0x00158AD2,
	0x0015C878,0x00160639,0x00164415,0x0016820C,0x0016C01F,
	0x0016FE4F,0x00173C9B,0x00177B04,0x0017B98B,0x0017F830,
	0x001836F3,0x001875D5,0x0018B4D7,0x0018F3F9,0x0019333B,
	0x0019729E,0x0019B222,0x0019F1C9,0x001A3192,0x001A717E,
	0x001AB18D,0x001AF1C1,0x001B3219,0x001B7297,0x001BB33A,
	0x001BF404,0x001C34F4,0x001C760C,0x001CB74D,0x001CF8B6,
	0x001D3A48,0x001D7C05,0x001DBDED,0x001E0000,0x001E423F,
	0x001E84AA,0x001EC744,0x001F0A0B,0x001F4D02,0x001F9028,
	0x001FD37F,0x00201707,0x00205AC1,0x00209EAD,0x0020E2CE,
	0x00212723,0x00216BAE,0x0021B06F,0x0021F566,0x00223A97,
	0x00228000,0x0022C5A3,0x00230B81,0x0023519B,0x002397F2,
	0x0023DE87,0x0024255B,0x00246C6F,0x0024B3C4,0x0024FB5C,
	0x00254338,0x00258B58,0x0025D3BF,0x00261C6D,0x00266563,
	0x0026AEA3,0x0026F82F,0x00274207,0x00278C2E,0x0027D6A4,
	0x0028216B,0x00286C84,0x0028B7F2,0x002903B6,0x00294FD1,
	0x00299C46,0x0029E915,0x002A3641,0x002A83CD,0x002AD1B8,
	0x002B2007,0x002B6EBA,0x002BBDD4,0x002C0D58,0x002C5D46,
	0x002CADA2,0x002CFE6E,0x002D4FAD,0x002DA161,0x002DF38D,
	0x002E4633,0x002E9957,0x002EECFB,0x002F4122,0x002F95D0,
	0x002FEB08,0x003040CD,0x00309723,0x0030EE0D,0x00314590,
	0x00319DAF,0x0031F66E,0x00324FD3,0x0032A9E0,0x0033049C,
	0x0033600B,0x0033BC31,0x00341915,0x003476BC,0x0034D52C,
	0x0035346B,0x00359480,0x0035F571,0x00365746,0x0036BA05,
	0x00371DB8,0x00378265,0x0037E817,0x00384ED6,0x0038B6AD,
	0x00391FA5,0x003989CB,0x0039F529,0x003A61CC,0x003ACFC2,
	0x003B3F19,0x003BAFE0,0x003C2228,0x003C9603,0x003D0B83,
	0x003D82BD,0x003DFBC7,0x003E76BA,0x003EF3AF,0x003F72C2,
	0x003FF414,0x004077C6,0x0040FDFE,0x004186E6,0x004212AC,
	0x0042A183,0x004333A6,0x0043C955,0x004462DB,0x0045008B,
	0x0045A2C8,0x00464A00,0x0046F6B9,0x0047A98D,0x00486337,
	0x00492498,0x0049EEC8,0x004AC325,0x004BA374,0x004C9209,
	0x004D921C,0x004EA84C,0x004FDBB3,0x00513846,0x0052D556,
	0x0054EF1F,0x005A0000,0x00000000,0x00000000,0x00000000,
};

//富氏滤波系数指针
WORD wFtFacCnt;
BYTE byCorrect, byCorrectChn;
//富氏滤波后的数据指针和缓冲区
volatile WORD  wFtPtr;          //数据指针,代表下面要写入的数据区，最新数据区是其-1
volatile long  lFt[FT_BUF_LEN][MAX_AI_NUM*2]; //递归富氏缓冲区,MAX_AI_NUM*2个实、虚部分量
volatile long  lFt0[MAX_AI_NUM*2];		     //递归富氏暂存值

volatile short nFtBus[SAMFT_BUF_LEN][3];  //Ia,Ib,Ic
volatile long  lFtBus[FT_BUF_LEN][36]={0};  //一\三\五谐波,Ia135,Ib135,Ic135

volatile long  lFtBus0[36]={0};  //一\三\五谐波

#if 0
WORD wFtFreq;
//47.5-52.5,0.25一档

FFT_FACTOR laFactor[FREQ_FOLLOW_NUM]={
 {21, 4750,
 {0,  2926,  5593,  7765,  9251,  9919,  9710,  8643,  6811,  4377,  1556,  
  -1402,  -4236,  -6696,  -8564,  -9675,  -9930,  -9307,  -7862,  -5721,  -3075,  },

 {9950,  9510,  8229,  6221,  3663,  781,  -2170,  -4930,  -7253,  -8935,  -9827,  
  -9850,  -9003,  -7359,  -5065,  -2323,  625,  3517,  6098,  8140,  9463,  }
 },

 {20, 4775,
 {0,  2956,  5648,  7835,  9323,  9977,  9740,  8633,  6755,  4273,  
  1409,  -1580,  -4429,  -6881,  -8719,  -9778,  -9963,  -9259,  -7727,  -5505,  },

 {10002,  9555,  8255,  6217,  3624,  706,  -2274,  -5051,  -7377,  -9043,  
  -9902,  -9876,  -8968,  -7259,  -4901,  -2105,  879,  3784,  6351,  8351,  }
 },

 {20, 4800,
 {0,  2987,  5704,  7906,  9394,  10035,  9769,  8622,  6696,  4166,  
  1260,  -1760,  -4621,  -7065,  -8871,  -9876,  -9990,  -9202,  -7584,  -5280,  },

 {10054,  9601,  8280,  6212,  3584,  631,  -2378,  -5172,  -7500,  -9151,  
  -9975,  -9899,  -8930,  -7154,  -4733,  -1884,  1135,  4051,  6602,  8556,  }
 },

 {20, 4825,
 {0,  3017,  5759,  7976,  9466,  10092,  9797,  8609,  6636,  4058,  
  1109,  -1941,  -4813,  -7247,  -9020,  -9970,  -10010,  -9138,  -7432,  -5049,  },

 {10107,  9646,  8305,  6207,  3543,  555,  -2483,  -5294,  -7623,  -9257,  
  -10046,  -9919,  -8887,  -7045,  -4560,  -1659,  1393,  4318,  6849,  8755,  }
 },

 {20, 4850,
 {0,  3048,  5815,  8047,  9537,  10148,  9824,  8595,  6574,  3947,  
  956,  -2123,  -5006,  -7428,  -9165,  -10058,  -10024,  -9066,  -7273,  -4810,  },

 {10159,  9691,  8330,  6201,  3501,  479,  -2588,  -5417,  -7746,  -9361,  
  -10114,  -9935,  -8840,  -6931,  -4383,  -1431,  1652,  4584,  7093,  8948,  }
 },

 {20, 4875,
 {0,  3079,  5872,  8118,  9608,  10204,  9850,  8579,  6509,  3834,  
  801,  -2306,  -5198,  -7607,  -9307,  -10141,  -10031,  -8987,  -7106,  -4564,  },

 {10212,  9736,  8355,  6195,  3459,  401,  -2695,  -5539,  -7868,  -9465,  
  -10180,  -9948,  -8790,  -6813,  -4202,  -1200,  1913,  4849,  7333,  9135,  }
 },

 {20, 4900,
 {0,  3110,  5928,  8189,  9679,  10259,  9874,  8561,  6443,  3718,  
  644,  -2490,  -5390,  -7784,  -9445,  -10218,  -10031,  -8900,  -6932,  -4312,  },

 {10264,  9781,  8379,  6188,  3416,  322,  -2802,  -5662,  -7990,  -9567,  
  -10244,  -9957,  -8735,  -6690,  -4017,  -966,  2176,  5113,  7570,  9314,  }
 },

 {20, 4925,
 {0,  3142,  5985,  8260,  9750,  10313,  9898,  8542,  6374,  3601,  
  486,  -2675,  -5582,  -7959,  -9580,  -10291,  -10024,  -8805,  -6749,  -4052,  },

 {10316,  9826,  8403,  6181,  3372,  243,  -2909,  -5785,  -8112,  -9667,  
  -10305,  -9963,  -8675,  -6563,  -3828,  -729,  2440,  5376,  7802,  9487,  }
 },

 {20, 4950,
 {0,  3173,  6042,  8331,  9820,  10367,  9920,  8520,  6303,  3482,  
  326,  -2861,  -5774,  -8133,  -9711,  -10357,  -10010,  -8702,  -6559,  -3787,  },

 {10369,  9871,  8427,  6173,  3328,  163,  -3018,  -5909,  -8233,  -9767,  
  -10364,  -9966,  -8612,  -6432,  -3635,  -488,  2705,  5638,  8031,  9652,  }
 },

 {20, 4975,
 {0,  3205,  6099,  8402,  9891,  10421,  9941,  8498,  6231,  3360,  
  164,  -3049,  -5965,  -8304,  -9838,  -10418,  -9989,  -8591,  -6361,  -3515,  },

 {10421,  9916,  8450,  6165,  3282,  82,  -3127,  -6032,  -8353,  -9864,  
  -10420,  -9965,  -8545,  -6296,  -3437,  -246,  2970,  5898,  8254,  9810,  }
 },

 {20, 5000,
 {0,  3236,  6156,  8473,  9961,  10473,  9961,  8473,  6156,  3236,  
  0,  -3236,  -6156,  -8473,  -9961,  -10473,  -9961,  -8473,  -6156,  -3236,  },

 {10473,  9961,  8473,  6156,  3236,  0,  -3236,  -6156,  -8473,  -9961,  
  -10473,  -9961,  -8473,  -6156,  -3236,  0,  3236,  6156,  8473,  9961,  }
 },

 {19, 5025,
 {0,  3268,  6214,  8545,  10031,  10525,  9979,  8447,  6079,  3111,  
  -165,  -3425,  -6346,  -8640,  -10080,  -10523,  -9926,  -8347,  -5944,  },

 {10526,  10005,  8496,  6147,  3190,  -83,  -3347,  -6280,  -8593,  -10056,  
  -10524,  -9953,  -8397,  -6012,  -3032,  248,  3503,  6412,  8687,  }
 },

 {19, 5050,
 {0,  3300,  6271,  8616,  10101,  10577,  9997,  8419,  6001,  2983,  
  -332,  -3614,  -6536,  -8805,  -10194,  -10566,  -9883,  -8214,  -5724,  },

 {10578,  10050,  8519,  6137,  3142,  -166,  -3458,  -6404,  -8711,  -10149,  
  -10573,  -9941,  -8317,  -5863,  -2823,  498,  3770,  6666,  8896,  }
 },

 {19, 5075,
 {0,  3333,  6329,  8688,  10170,  10628,  10013,  8389,  5920,  2853,  
  -501,  -3804,  -6725,  -8967,  -10305,  -10604,  -9834,  -8073,  -5497,  },

 {10630,  10095,  8541,  6126,  3094,  -250,  -3570,  -6529,  -8830,  -10240,  
  -10619,  -9926,  -8233,  -5710,  -2611,  751,  4037,  6917,  9099,  }
 },

 {19, 5100,
 {0,  3365,  6387,  8759,  10240,  10678,  10028,  8358,  5837,  2722,  
  -671,  -3995,  -6912,  -9126,  -10411,  -10635,  -9777,  -7924,  -5264,  },

 {10683,  10139,  8563,  6115,  3045,  -336,  -3682,  -6653,  -8947,  -10330,  
  -10662,  -9908,  -8145,  -5553,  -2396,  1005,  4304,  7165,  9296,  }
 },

 {19, 5125,
 {0,  3397,  6446,  8831,  10309,  10727,  10042,  8325,  5752,  2588,  
  -842,  -4186,  -7099,  -9283,  -10512,  -10661,  -9714,  -7768,  -5023,  },

 {10735,  10183,  8585,  6104,  2995,  -421,  -3795,  -6778,  -9064,  -10419,  
  -10702,  -9885,  -8053,  -5392,  -2177,  1262,  4571,  7410,  9487,  }
 },

 {19, 5150,
 {0,  3430,  6504,  8903,  10378,  10776,  10055,  8290,  5665,  2452,  
  -1015,  -4377,  -7285,  -9437,  -10609,  -10680,  -9642,  -7604,  -4776,  },

 {10788,  10228,  8606,  6092,  2944,  -508,  -3908,  -6902,  -9180,  -10505,  
  -10740,  -9860,  -7956,  -5227,  -1955,  1520,  4837,  7652,  9673,  }
 },

 {19, 5175,
 {0,  3463,  6563,  8975,  10447,  10824,  10066,  8254,  5577,  2315,  
  -1190,  -4569,  -7470,  -9588,  -10701,  -10693,  -9564,  -7433,  -4523,  },

 {10840,  10272,  8627,  6079,  2893,  -596,  -4022,  -7027,  -9296,  -10590,  
  -10775,  -9830,  -7855,  -5057,  -1729,  1780,  5102,  7890,  9851,  }
 },

 {19, 5200,
 {0,  3496,  6622,  9047,  10515,  10871,  10076,  8216,  5486,  2175,  
  -1365,  -4761,  -7653,  -9736,  -10788,  -10699,  -9478,  -7254,  -4263,  },

 {10892,  10316,  8648,  6066,  2841,  -684,  -4137,  -7152,  -9410,  -10673,  
  -10806,  -9797,  -7750,  -4884,  -1501,  2041,  5367,  8125,  10023,  }
 },

 {19, 5225,
 {0,  3529,  6681,  9119,  10584,  10917,  10085,  8176,  5393,  2034,  
  -1542,  -4953,  -7836,  -9881,  -10871,  -10700,  -9385,  -7069,  -3997,  },

 {10945,  10360,  8669,  6052,  2788,  -773,  -4252,  -7276,  -9524,  -10754,  
  -10836,  -9760,  -7641,  -4707,  -1269,  2304,  5630,  8356,  10189,  }
 },

 {19, 5250,
 {0,  3562,  6740,  9191,  10652,  10963,  10093,  8134,  5298,  1891,  
  -1720,  -5146,  -8017,  -10023,  -10948,  -10693,  -9285,  -6876,  -3725,  },

 {10997,  10404,  8689,  6038,  2735,  -863,  -4367,  -7401,  -9637,  -10833,  
  -10862,  -9719,  -7528,  -4525,  -1035,  2567,  5893,  8582,  10347,  }
 },

};
#endif
/*short nExampleSam[] = 
{
	4054,   3903,   3483,	 2827,	1978,   993,	 -60,   -1106,
	-2077,	-2906,	-3538,	-3928,	-4051,	-3901,	-3480,	-2825,
	-1976,	-992,   61,	1110,   2080,   2912,	 3542,	3932
};*/

#if 0
/********************************************************************
Subroutine:	Calculate Amplitude of x+jy
Algorithem:
	a=max{|x|,|y|},b=min{|x|,|y|}  泰勒级数法
	m=(3*a+5*b*b/(3*a+b))/3	
//计算复数的模(幅值)
//参数:
//x=复数的实部
//y=复数的虚部
//返回值
//该复数的模(幅值)
********************************************************************/
DWORD AmXY(long x, long y)
{
	FAST long a, b, d;
	long long c;

    if (x<0) x = -x;
	if (y<0) y = -y;

	if (x == 0) return y;
	if (y == 0) return x;

    if (x>y) {a=x; b=y;}
	else {a=y; b=x;}

	c = 5LL*b*b;
	d = 3*(3*a+b);

	return((DWORD)(a+c/d));
}

DWORD AmXY(long x, long y)
{
	long a, b;
	int m, n;
	long long c, d;
	DWORD ret;

    if (x<0) x = -x;
	if (y<0) y = -y;

	if (x == 0) return y;
	if (y == 0) return x;

    if (x>y) {a=x; b=y;}
	else {a=y; b=x;}

    m=0;
	while (b>20000)      /*5*b*b < 7FFFFFFF*/
	{
        b>>=1;
		a>>=1;
		m++;
	}

    n = 0;
	if (a>0x10000000)    /*3*(3*a+b) < 12*a < 7FFFFFFF*/
	{
        n = 4;
		a >>= 4;
		b >>= 4; 
	}	

    c = 5*b*b;
	d = 3*(3*a+b);

	ret = (DWORD)(a+c/d);

	ret <<= m;
	ret <<= n;

	return ret;	
}
#endif

//计算复数的模(幅值)
//参数:
//x=复数的实部
//y=复数的虚部
//返回值
//该复数的模(幅值)
//根据实部虚部求有效值
//**********************************************
//;Subroutine:	Calculate Amplitude of x+jy
//;Prototype:		DWORD AmXY(long x,long y)
//;Algorithem:
//;	a=max{|x|,|y|},b=min{|x|,|y|}
//;	m=a+(5*b*b/(3*a+b))/3
//**********************************************
DWORD  AmXY(long x,long y)
{
 	unsigned long z,xx,yy;
	unsigned int cc;

	

	if( x<0 )
		x=-x;
	
	if( y<0 )
		y=-y;
	
	if( x==0 )
		return y;
	if( y==0 )
		return x;

	if( x<y )
	{
		z=x;
		x=y;
		y=z;
	}

	cc=0;
	xx=x;
	yy=y;


	while(xx>0x4000)  //防分母3*x+ y溢出!
	{
		cc++;
		xx>>=1;
		yy>>=1;
	}

    z=(5*yy*yy)/(3*xx+yy);
	
	z/=3;
	z<<=cc;

	z=x+z;	
	return z; 
}

//计算复数的角度
//参数:
//x=复数的实部
//y=复数的虚部
//rmt=有效值,如果rmt==0,则需要计算
//返回值:
//角度值(-180～180,高16位=整数,低16位=小数)
long AngPQ(long x, long y, DWORD rmt)
{
	long long xx, yy;
	long xx1,yy1;
	FAST WORD tmp;
	FAST WORD htmp;
	FAST BYTE ltmp;
	FAST long value;
	
	if (x<0) xx1 = -x;
	else xx1 = x;

	if (y<0) yy1 = -y;
	else yy1 = y;

    
	if (rmt == 0)  
		rmt = AmXY(x, y);
	
	if (rmt == 0)  
		return 0;


	if (xx1 > yy1)
	{ 
	    if((xx1&0xFFC00000) == 0)
		{
		   tmp = (xx1<<10)/rmt;
	    }
		else
		{
		   xx = xx1;
		   tmp = (xx<<10)/rmt;
		}
        htmp = tmp>>2;
		ltmp = tmp&0x3;

        /*tmp是sin()值放大了65536倍,将它等分256,表坐标0~257
          则整数部分是高位n,小数部分是低位m,按公式查表
          ASin[n]+(ASin[n+1]-ASin[n])*m/256
        */		
		value = ASin[htmp]+(((ASin[htmp+1]-ASin[htmp])*ltmp)>>2);
		value = 0x5A0000-value;   /*实部查ASin,90°换算*/
	}
	else
	{
	    if((yy1&0xFFC00000) == 0)
		{
		   tmp = (yy1<<10)/rmt;
	    }
		else
		{
		   yy = yy1;
		   tmp = (yy<<10)/rmt;
		}

        htmp = tmp>>2;
		ltmp = tmp&0x03;
		value = ASin[htmp]+(((ASin[htmp+1]-ASin[htmp])*ltmp)>>2);
	}

	if (x>0)
	{
        if (y<0) value = -value;  
	}
	else
	{
		if (y>0) value = 0xB40000-value;    /*180-value*/
		else value = value-0xB40000;        /*value-180*/
	}		

	return value;
}

//相间方向元件角度差判别  //辅助子程序
//long lAngTemp 相间方向元件角度差值Ur/Ir
BYTE  UIAngpb(long lAngTemp)
{
	//规格化lAngTemp在-180~+180之间
	if (lAngTemp<-11796480)
  	{
		lAngTemp+=23592960;
	}
	else if (lAngTemp>11796480)
  	{
 		lAngTemp-=23592960;
 	}
	//if(lAngTemp>(((long)-90)<<16)&&lAngTemp<(((long)30)<<16))		//如果U超前I小于90且滞后小于30度
	if(lAngTemp>(((long)120)<<16)||lAngTemp<(((long)-60)<<16))	
		//如果U超前I小于120且滞后小于60度//WAAA 2010-4-6 浙江任意负载试验
		return 1;
	else
		return 0;
}

WORD Sqrt_Dword(DWORD x)
{
	DWORD	Temp,Temp1;
	WORD	i,j;

	if (x==0) return (0);
	
	i=0;
	Temp=x;

	while ( (Temp&0x80000000)==0 )
	{
		i++;
		Temp<<=1;
	}
	
	if (i>16)	j=0xff;
	else
	{
		i>>=1;
		j=0xffff;
		j>>=(BYTE) i;
	}

_Sqrt_Loop:
	
	if ( (WORD)(x>>16) >= j )	return (j);
	else 
	{
		Temp=x/(DWORD)j;
		if ( (WORD)Temp >= j )	return (j);
		else
		{
			i=0;
			Temp1=(DWORD)j;
			j+=(WORD)Temp;
			Temp+=Temp1;
			if ( Temp>0xffff )	i++;
			j>>=1;
			if ( (i&0x1) == 1 )	j|=0x8000;
			i>>=1;
		}
	}
	goto	_Sqrt_Loop;
}

void protectCal_Correct(int flag)
{
     byCorrect = flag;
}

void protectCal_CorrectBus(int index, int chn)
{
#ifdef INCLUDE_FA_DIFF
   int i,ai_chn,hw;
   long lSam, lCos, lSin;
   long *pFAFre, *pFAFim;
   int cur = (index - FT_SAM_POINT_N)&(SAMFT_BUF_LEN-1);

   ai_chn = chn/6;
   hw = chn%6;

   pFAFre = &laFAFre[hw][0];
   pFAFim = &laFAFim[hw][0];

   lSam = lCos = 0;
   for (i=0; i<FT_SAM_POINT_N; i++)
   {
       lSam=nFtBus[cur][ai_chn]-nFtBus[(cur - FT_DIFF)&(SAMFT_BUF_LEN - 1)][ai_chn];
	   lCos+=lSam*pFAFre[i];
	   lSin+=lSam*pFAFim[i];
	   cur = (cur + 1)&(SAMFT_BUF_LEN - 1);
   }
   lFtBus0[chn*2] = lCos;
   lFtBus0[chn*2+1] = lSin;  
#endif
}

void protectCal_Busft(void)
{
#ifdef INCLUDE_FA_DIFF
	long *pFAFre, *pFAFim; 
	long tmp, tmp1, tmp2;
	int i, j, cur;
	volatile long *plFt, *plFt0;
	volatile short *k0, *k3, *kk0, *kk3;
	
    nFtBus[wFtSamCnt][0] = 0;
	nFtBus[wFtSamCnt][1] = 0;
	nFtBus[wFtSamCnt][2] = 0;
	
	for (i=0; i<aiChnNum; i++)
   	{
   	    if ((pAiCfg[i].type < YC_TYPE_Ia) || (pAiCfg[i].type > YC_TYPE_Ic))
		    continue;
		nFtBus[wFtSamCnt][pAiCfg[i].type - YC_TYPE_Ia] += nFtSam[wFtSamCnt][i] - pMeaGain[i].b;
	}
	
	
	cur = wFtSamCnt;
	if ((byCorrect == 1)&&(wFtFacCnt == 0))
	{
        protectCal_CorrectBus(cur, byCorrectChn);
		byCorrectChn++;
	}

	if (byCorrectChn == 18)
	{
	    byCorrect = 0;
		byCorrectChn = 0;
	}

	for (i=0; i<3; i++)
	{
		k0 = &nFtBus[cur][i];
		k3 = &nFtBus[(cur-FT_DIFF)&(SAMFT_BUF_LEN-1)][i];
		kk0 = &nFtBus[(cur-FT_SAM_POINT_N)&(SAMFT_BUF_LEN-1)][i];
	    kk3 = &nFtBus[(cur-FT_SAM_POINT_N-FT_DIFF)&(SAMFT_BUF_LEN-1)][i];

		tmp = *k0 -*k3 - *kk0 + *kk3;  //???

		plFt = &lFtBus[wFtPtr][i*12];
		plFt0 = &lFtBus0[i*12];

		for (j=0; j<6; j++)
		{
			pFAFre = &laFAFre[j][wFtFacCnt];
			pFAFim = &laFAFim[j][wFtFacCnt];


			tmp1 = *pFAFre*tmp;
			tmp2 = *pFAFim*tmp;

			 *plFt0 += tmp1;
			*plFt = *plFt0>>7;		
			plFt0++; plFt++;
			
			*plFt0 += tmp2;
			*plFt = *plFt0>>7;		
			plFt0++; plFt++;
		}
	}
#endif
}

void protectCal_CorrectAi(int index, int chn)
{
#ifdef INCLUDE_FA_DIFF
   int i,ai_chn,hw;
   long lSam, lCos, lSin;
   long *pFAFre, *pFAFim;
   int cur = (index - FT_SAM_POINT_N)&(SAMFT_BUF_LEN-1);

   pFAFre = &laFAFre[0][0];
   pFAFim = &laFAFim[0][0];

   lCos = lSin =0;
   for (i=0; i<FT_SAM_POINT_N; i++)
   {
       lSam=nFtSam[cur][chn]-nFtSam[(cur - FT_DIFF)&(SAMFT_BUF_LEN-1)][chn];
	   lCos+=lSam*pFAFre[i];
	   lSin+=lSam*pFAFim[i];
	   cur = (cur + 1)&(SAMFT_BUF_LEN - 1);
   }

  
   lFt0[chn*2] = lCos;
   lFt0[chn*2+1] = lSin;  
#endif
}


#ifdef INCLUDE_FA_DIFF
void protectCal_ft(void)
{
#ifdef INCLUDE_PR
	FAST const long *pFAFre, *pFAFim; 
	FAST volatile long *plFt, *plFt0;
	FAST long tmp, tmp1, tmp2;
	FAST int i, cur;
	FAST volatile short *k0, *k3, *kk0, *kk3;
	static BOOL first = 0;

    wFtPtr = (wFtPtr+1)&(FT_BUF_LEN -1);	

	cur = wFtSamCnt;

	wFtFacCnt++;

	if (wFtFacCnt == FT_SAM_POINT_N) wFtFacCnt = 0;


	if ((byCorrect == 2)&&(wFtFacCnt == 0))
	{
        protectCal_CorrectAi(cur, byCorrectChn);
		byCorrectChn++;
	}

	if (byCorrectChn == aiChnNum)
	{
	    byCorrect = 1;
		byCorrectChn = 0;
	}
	
	pFAFre = &laFAFre[0][wFtFacCnt];
	pFAFim = &laFAFim[0][wFtFacCnt];

	k0 = &nFtSam[cur][0];
	k3 = &nFtSam[(cur - FT_DIFF)&(SAMFT_BUF_LEN-1)][0];
	kk0 = &nFtSam[(cur - FT_SAM_POINT_N)&(SAMFT_BUF_LEN-1)][0];
	kk3 = &nFtSam[(cur - FT_SAM_POINT_N - FT_DIFF)&(SAMFT_BUF_LEN-1)][0];

	plFt = &lFt[wFtPtr][0];
	plFt0 = &lFt0[0];

    for (i=0; i<aiChnNum; i++)
    {
   
		tmp = *k0-*k3+*kk3-*kk0;  //???
		tmp1 = *pFAFre*tmp;
		tmp2 = *pFAFim*tmp;


	    /*下面指针移动,所以不能放入if语句中*/
        *plFt0 += tmp1;
		*plFt = *plFt0>>7;		
		plFt0++; plFt++;
		
		*plFt0 += tmp2;
		*plFt = *plFt0>>7;		
		plFt0++; plFt++;
		
		
		k0++; k3++;
		kk0++; kk3++;
    }

#ifdef INCLUDE_FA_DIFF
	protectCal_Busft();
#endif
#endif
}
#else
/*该函数采样中断调用 每点运算一次形成递推傅氏计算,注意效率*/  
void protectCal_ft(void)
{
#ifdef INCLUDE_PR
	FAST const long *pFAFre, *pFAFim; 
	FAST volatile long *plFt, *plFt0;
	FAST long tmp, tmp1, tmp2;
	FAST int i, cur;
	FAST volatile short *k0, *k3, *kk0, *kk3;
#ifdef INCLUDE_PR_PRO
    //WORD index;
#endif
	//FAST VAiCfg *pCfg;

	//pCfg = pAiCfg;

    wFtPtr = (wFtPtr+1)&(FT_BUF_LEN -1);	
	
	wFtFacCnt++;


	if (wFtFacCnt == FT_SAM_POINT_N) wFtFacCnt = 0;

	pFAFre = &laFAFre[0][wFtFacCnt];
	pFAFim = &laFAFim[0][wFtFacCnt];

	cur = wFtSamCnt;
	k0 = &nFtSam[cur][0];
	k3 = &nFtSam[(cur-FT_DIFF)&(SAMFT_BUF_LEN-1)][0];
	kk0 = &nFtSam[(cur-(FT_SAM_POINT_N>>1))&(SAMFT_BUF_LEN-1)][0];
	kk3 = &nFtSam[(cur-(FT_SAM_POINT_N>>1)-FT_DIFF)&(SAMFT_BUF_LEN-1)][0];

	plFt = &lFt[wFtPtr][0];
	plFt0 = &lFt0[0];
    for (i=0; i<aiChnNum; i++)
    {
        //if(pCfg->protect_enable)  //要求计算
		{   
			tmp = *k0-*k3-*kk3+*kk0;  //???
			tmp1 = *pFAFre*tmp;
			tmp2 = *pFAFim*tmp;
			
    	}
	    //else
        //    tmp1 = tmp2 =0;

	    /*下面指针移动,所以不能放入if语句中*/
        *plFt0 += tmp1;
		*plFt = *plFt0>>6;		
		plFt0++; plFt++;
		
		*plFt0 += tmp2;
		*plFt = *plFt0>>6;		
		plFt0++; plFt++;
		
		
		k0++; k3++;
		kk0++; kk3++;
		//pCfg++;
    }
#endif
}
#endif

#if 0
extern int prtest;
void protoct_Tblqd(void)
{
	FAST int i, cur, delta;
	FAST VAiCfg *pCfg;
	FAST volatile short *k0, *k1, *k2;
	static int qd = 0;

    if (aiNUM == 0) return;

	pCfg = pAiCfg;
		
    /*注意,我是按ptr代表即将写入区设计的,最新数据区是其-1,要和驱动那边对应*/
	//cur = (wSamCnt-1)&(SAM_BUF_LEN-1);
	cur = wSamCnt;

	//for (i=0; i<aiNUM; i++)
	i = 2;
	{
		//if ((pCfg->protect_enable) && ((pCfg->type == YC_TYPE_Ia) || (pCfg->type == YC_TYPE_Ib) || (pCfg->type == YC_TYPE_Ic)))
		//if ((pCfg->protect_enable) && (pCfg->type == YC_TYPE_Ia))
		{	
			k0 = &nSam[cur][i];
			k1 = &nSam[(cur-SAM_POINT_N)&(SAM_BUF_LEN-1)][i];
			k2 = &nSam[(cur-SAM_POINT_N<<1)&(SAM_BUF_LEN-1)][i];

			delta = (*k0) - (*k1)*2 + (*k2);	
			//if (delta < 0) delta = -delta;

			//delta <<= 8;

			//if ((prtest) && (qd == 0)) qd = 60;

			//if (qd > 0)
			if (delta > 10)
			{
				logMsg("%d: %ld, delat=%ld\n", qd, GetMsCnt(), delta);
				//qd--;
			}	
		}
		pCfg++;
	}	
}
#endif


void InitGenFlags(void)
{
	short *np;
	long *lp;
	int i,j;

	//采样值、富氏滤波值及富氏滤波系数指针
	wMeaSamCnt = 0;
	wFtSamCnt = 0;
	wFtPtr = 0;
	wFtFacCnt = 0;
	byCorrect = 0;
	
	//采样值、富氏滤波值数据区清零
    //memset(nMeaSam, 0, sizeof(nMeaSam));
    //memset(nFtSam, 0, sizeof(nFtSam));
    //memset(lFt, 0, sizeof(lFt));
    //memset(lFt0, 0, sizeof(lFt0));	
	
	{
	  np=(short *)(&nMeaSam[0][0]);
	  for( i=0; i<SAM_BUF_LEN; i++)
	    for( j=0; j<AITOTAL_NUMBER; j++)
		   *np++=0;

	  np=(short *)(&nFtSam[0][0]);
	  for( i=0; i<SAMFT_BUF_LEN; i++)
		for( j=0; j<AITOTAL_NUMBER; j++)
			*np++=0;
	
	  lp=(long *)(&lFt[0][0]);
	  for( i=0; i<FT_BUF_LEN; i++)
		for(j=0;j<MAX_AI_NUM*2;j++)
			*lp++=0;
	
	  lp=(long *)(&lFt0[0]);
	  for( j=0; j<MAX_AI_NUM*2; j++)
		  *lp++=0;
	}

}

#if 0
/////////////////////////////////////////////////////////////
//**********************************************************************
//数学库函数
//**********************************************************************
typedef struct tagCInt64 {
	long			hi;
	unsigned long	lo;
}CInt64_new;


//**********************************************
//无符号数乘除
//长整数(n)乘以另一个长整数(a)再除以一个长整数(b)
//参数:n,a,b
//返回值 (n)x(a)/(b)
//**********************************************
unsigned long _Mul_Div_U(unsigned long n,unsigned long a,unsigned long b)
{
	CInt64_new C64_n,C64_a,C64_b;
	CInt64_new C64_mul,C64_div;
	
	C64_n.hi=C64_a.hi=C64_b.hi=0;
	C64_n.lo=n;
	C64_a.lo=a;
	C64_b.lo=b;
	
	//__rt_mul64(&C64_mul,C64_n,C64_a);
	//__rt_divu64(&C64_div,C64_mul,C64_b);
	
	return C64_div.lo;
}
//************************************************
//长整数(n)乘以另一个长整数(a)再除以一个长整数(b)
//参数:n,a,b
//返回值 (n)x(a)/(b)
//************************************************
long _MulFac2(long n,long a,long b)
{
	long dwhl;
	BOOL bFH=FALSE;

	if(n<0)
	{
		n = -n;
		bFH = TRUE;
	}
	
	if(a<0)
	{
		a = -a;
		if(bFH)   //true
			bFH = FALSE;
		else
			bFH = TRUE;
	}
	
	if(b<0)
	{
		b = -b;
		if(bFH)   //true
			bFH = FALSE;
		else
			bFH = TRUE;
	}
	
	dwhl = _Mul_Div_U(n,a,b);
	
	if(bFH)     //负
		dwhl = -dwhl;
	
	return dwhl;
}

//********************************************
//长整数(n)乘以另一个长整数(f)
//参数:n=被乘数,f=乘数(高16位=整数部分,低16位=小数部分)
//返回值:(v)x(f)/65536
//注:相乘后的结果应不超过48位,否则出现溢出错误
//2007.1.5 修改原因为原程序可能存在溢出可能(无符号不会溢出)
//	dwhl += ((nl*fl)>>16);   //2007.1.5
//********************************************
long _MulFac(long n,long f)
{
	uint16 nl,nh,fl,fh;
	long dwhl;
	BOOL bFH=FALSE;
	
	if(n<0)
	{
		n = -n;
		bFH = TRUE;
	}
	
	if(f<0)
	{
		f = -f;
		if(bFH)   //true
			bFH = FALSE;
		else
			bFH = TRUE;
	}
		
	nl = n;
	nh = (n>>16);
	fl = f;
	fh = (f>>16);
	
	dwhl = (uint32)(nl*fh+nh*fl);     //2007.1.5

	dwhl += ((uint32)(nh*fh)<<16);   //2007.1.5
	dwhl += ((uint32)(nl*fl)>>16);   //2007.1.5
	
	if(bFH)     //负
		dwhl = -dwhl;
	
	return dwhl;
}


unsigned long _abs(long x)
{
	if(x<0)
	    return -x;
	else
	    return x;
}

/////////////////////////////////////////////////////////////
#endif


#endif

